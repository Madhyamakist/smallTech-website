(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{559:(e,s,t)=>{Promise.resolve().then(t.bind(t,5244))},5244:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var i=t(5155),l=t(2115);function a(e){let{label:s,options:t,fetchOptions:a,onSelect:n}=e,[d,o]=(0,l.useState)(null!=t?t:[]),[r,c]=(0,l.useState)(!1),[x,h]=(0,l.useState)(s);(0,l.useEffect)(()=>{h(s)},[s]),(0,l.useEffect)(()=>{if(t&&t.length)return void o(t);if(a){let e=!0;return a().then(s=>{e&&o(s)}).catch(console.error),()=>{e=!1}}},[t,a]);let m=e=>{h(e.label),n(e.value),c(!1)};return(0,i.jsxs)("div",{className:"",children:[(0,i.jsxs)("button",{className:"btnDropdown",onClick:()=>c(!r),children:[x," ",(0,i.jsx)("span",{className:"arrow",children:"▾"})]}),r&&(0,i.jsx)("ul",{className:"txt",children:d.map((e,s)=>(0,i.jsx)("li",{className:"listItem",onClick:()=>m(e),children:e.label},s))})]})}async function n(e){let s=await fetch("".concat("http://35.208.129.40:5000","/chat-info"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Update failed")}return s.json()}var d=t(6268),o=t(1032);let r={OPEN:"text-blue-700 font-semibold",CLOSED:"text-red-600 font-semibold",QUALIFYING:"text-green-800 font-semibold"};function c(e){let{initialRows:s}=e,{rows:t,error:c,saving:h,expanded:m,setExpanded:u,onChangeStatus:b,onSaveRemarks:p,histories:v,historyLoading:j,historyError:N,loadHistory:g}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[s,t]=(0,l.useState)(e);(0,l.useEffect)(()=>{t(e||[])},[e]);let[i,a]=(0,l.useState)(null),[d,o]=(0,l.useState)({}),[r,c]=(0,l.useState)({}),[x,h]=(0,l.useState)({}),[m,u]=(0,l.useState)({}),[b,p]=(0,l.useState)({}),v=async e=>n(e),j=(0,l.useCallback)(async(e,s)=>{t(t=>t.map(t=>t.session_id===e?{...t,status:s}:t)),o(s=>({...s,[e]:!0}));try{await v({session_id:e,status:s})}catch(e){a(e.message)}finally{o(s=>({...s,[e]:!1}))}},[]),N=(0,l.useCallback)(async(e,s)=>{o(s=>({...s,[e]:!0}));try{await v({session_id:e,remarks:s}),t(t=>t.map(t=>t.session_id===e?{...t,remarks:s}:t))}catch(e){a(e.message)}finally{o(s=>({...s,[e]:!1}))}},[]),g=(0,l.useCallback)(async e=>{if(!m[e]){u(s=>({...s,[e]:!0})),p(s=>({...s,[e]:void 0}));try{let t="".concat("http://35.208.129.40:5000","/history?session_id=").concat(encodeURIComponent(e)),i=await fetch(t,{method:"GET"}),l=await i.json();if(i.ok){var s;let t=(null==(s=l.history)?void 0:s.map(e=>({sender:"human"===e.type?"You":"Bot",text:e.content})))||[];h(s=>({...s,[e]:t}))}else{let s=l&&(l.error||l.message)||"Failed to load history";p(t=>({...t,[e]:String(s)}))}}catch(s){p(t=>({...t,[e]:s.message}))}finally{u(s=>({...s,[e]:!1}))}}},[m]);return{rows:s,error:i,saving:d,expanded:r,setExpanded:c,onChangeStatus:j,onSaveRemarks:N,histories:x,historyLoading:m,historyError:b,loadHistory:g}}(s),[y,f]=(0,l.useState)(1),w=Math.max(1,Math.ceil(t.length/6)),_=(y-1)*6,k=t.slice(_,_+6),S=e=>{let s=Math.min(Math.max(1,e),w);f(()=>s),u({})},C=(0,l.useMemo)(()=>[{header:"Session Id",accessorKey:"session_id",cell:e=>{let{row:s}=e,t=s.original,l=!!m[t.session_id];return(0,i.jsx)("button",{type:"button",className:"hover:text-blue-300",onClick:()=>{u(e=>({...e,[t.session_id]:!l})),l||v[t.session_id]||j[t.session_id]||g(t.session_id)},children:t.session_id?"".concat(t.session_id.slice(0,5),"..."):""})}},{header:"Name",accessorKey:"name",cell:e=>{let{row:s}=e;return s.original.name}},{header:"Contact Details",id:"contact",cell:e=>{let{row:s}=e,t=s.original;return(0,i.jsxs)("div",{className:"text-white/90",children:[(0,i.jsxs)("div",{children:["email: ",t.email]}),(0,i.jsxs)("div",{children:["country: ",t.country]}),(0,i.jsxs)("div",{children:["mobile: ",t.mobile_number]})]})}},{header:"Status",id:"status",cell:e=>{let{row:s}=e,t=s.original;return(0,i.jsx)("div",{className:"w-44 ".concat(r[t.status]),children:(0,i.jsx)(a,{label:t.status,options:[{label:"OPEN",value:"OPEN"},{label:"CLOSED",value:"CLOSED"},{label:"QUALIFYING",value:"QUALIFYING"}],onSelect:e=>b(t.session_id,e)})})}},{header:"Remarks",id:"remarks",cell:e=>{var s;let{row:t}=e,l=t.original;return(0,i.jsx)(x,{sessionId:l.session_id,initialRemarks:null!=(s=l.remarks)?s:"",saving:!!h[l.session_id],onSave:p})}}],[m,v,j,b,p,u,g,h]),E=(0,d.N4)({data:t,columns:C,getCoreRowModel:(0,o.HT)(),autoResetPageIndex:!1});return(0,i.jsxs)("section",{className:"p-6",children:[(0,i.jsx)("h1",{className:"text-xl mb-4 text-white",children:"Dashboard"}),c&&(0,i.jsx)("div",{className:"mb-3 text-yellow-200",children:c}),(0,i.jsx)("div",{className:"overflow-x-auto rounded-lg shadow-md hidden md:block bg-brown",children:(0,i.jsxs)("table",{className:"min-w-full",children:[(0,i.jsx)("thead",{children:E.getHeaderGroups().map(e=>(0,i.jsx)("tr",{children:e.headers.map(e=>(0,i.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-white bg-brown",children:(0,d.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,i.jsx)("tbody",{children:E.getRowModel().rows.slice(_,_+6).map(e=>{let s=e.original,t=!!m[s.session_id];return(0,i.jsxs)(l.Fragment,{children:[(0,i.jsx)("tr",{className:"bg-liver",children:e.getVisibleCells().map(e=>(0,i.jsx)("td",{className:"px-4 py-3 text-sm text-white/90 border-t border-cinereous",children:(0,d.Kv)(e.column.columnDef.cell,e.getContext())},e.id))}),t&&(0,i.jsx)("tr",{className:"bg-liver",children:(0,i.jsx)("td",{className:"px-4 py-3 text-sm text-white/80",colSpan:e.getVisibleCells().length,children:(0,i.jsxs)("div",{className:"rounded-lg p-3 bg-brown",children:[(0,i.jsxs)("div",{className:"mb-2 text-xs text-white/70",children:[(0,i.jsx)("strong",{children:"Session ID:"})," ",s.session_id]}),j[s.session_id]&&(0,i.jsx)("div",{className:"text-white/70",children:"Loading history…"}),!j[s.session_id]&&N[s.session_id]&&(0,i.jsx)("div",{className:"text-yellow-200",children:N[s.session_id]}),!j[s.session_id]&&!N[s.session_id]&&(0,i.jsxs)("div",{className:"flex flex-col space-y-2",children:[0===(v[s.session_id]||[]).length&&(0,i.jsx)("div",{className:"text-white/70",children:"No history available."}),(v[s.session_id]||[]).map((e,s)=>(0,i.jsx)("div",{className:"max-w-[85%] px-3 py-[1%] rounded-lg ".concat("You"===e.sender?"bg-redwood self-end text-cinereous font-semibold":"bg-cinereous self-start text-brown font-semibold"),children:e.text},s))]})]})})})]},e.id)})})]})}),(0,i.jsx)("div",{className:"md:hidden space-y-3",children:k.map(e=>{var s;let t=!!m[e.session_id];return(0,i.jsxs)("div",{className:"rounded-lg shadow-md p-4 bg-liver bg-brown",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("div",{className:"text-white font-semibold",children:e.name}),(0,i.jsx)("button",{type:"button",className:"text-blue-300",onClick:()=>{u(s=>({...s,[e.session_id]:!t})),t||v[e.session_id]||j[e.session_id]||g(e.session_id)},children:e.session_id?"".concat(e.session_id.slice(0,5),"..."):""})]}),(0,i.jsxs)("div",{className:"mt-2 text-white/90 text-sm",children:[(0,i.jsxs)("div",{children:["email: ",e.email]}),(0,i.jsxs)("div",{children:["country: ",e.country]}),(0,i.jsxs)("div",{children:["mobile: ",e.mobile_number]})]}),(0,i.jsx)("div",{className:"mt-3 flex items-center gap-3",children:(0,i.jsx)("div",{className:"w-40 ".concat(r[e.status]),children:(0,i.jsx)(a,{label:e.status,options:[{label:"OPEN",value:"OPEN"},{label:"CLOSED",value:"CLOSED"},{label:"QUALIFYING",value:"QUALIFYING"}],onSelect:s=>b(e.session_id,s)})})}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(x,{sessionId:e.session_id,initialRemarks:null!=(s=e.remarks)?s:"",saving:!!h[e.session_id],onSave:p})}),t&&(0,i.jsxs)("div",{className:"mt-3 rounded-lg p-3 bg-brown",children:[(0,i.jsxs)("div",{className:"mb-2 text-xs text-white/70",children:[(0,i.jsx)("strong",{children:"Session ID:"})," ",e.session_id]}),j[e.session_id]&&(0,i.jsx)("div",{className:"text-white/70",children:"Loading history…"}),!j[e.session_id]&&N[e.session_id]&&(0,i.jsx)("div",{className:"text-yellow-200",children:N[e.session_id]}),!j[e.session_id]&&!N[e.session_id]&&(0,i.jsxs)("div",{className:"flex flex-col space-y-2",children:[0===(v[e.session_id]||[]).length&&(0,i.jsx)("div",{className:"text-white/70",children:"No history available."}),(v[e.session_id]||[]).map((e,s)=>(0,i.jsx)("div",{className:"max-w-[85%] px-3 py-[1%] rounded-lg ".concat("You"===e.sender?"bg-redwood self-end text-cinereous font-semibold":"bg-cinereous self-start text-brown font-semibold"),children:e.text},s))]})]})]},e.session_id)})}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-4 text-white",children:[(0,i.jsxs)("div",{className:"text-sm",children:["Page ",y," of ",w]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{type:"button",className:"px-3 py-2 rounded-md bg-caput text-white disabled:opacity-50",onClick:()=>S(1),disabled:1===y,children:"\xab First"}),(0,i.jsx)("button",{type:"button",className:"px-3 py-2 rounded-md bg-caput text-white disabled:opacity-50",onClick:()=>S(y-1),disabled:1===y,children:"‹ Prev"}),(0,i.jsx)("button",{type:"button",className:"px-3 py-2 rounded-md bg-caput text-white disabled:opacity-50",onClick:()=>S(y+1),disabled:y===w,children:"Next ›"}),(0,i.jsx)("button",{type:"button",className:"px-3 py-2 rounded-md bg-caput text-white disabled:opacity-50",onClick:()=>S(w),disabled:y===w,children:"Last \xbb"})]})]})]})}function x(e){let{sessionId:s,initialRemarks:t,saving:a,onSave:n}=e,[d,o]=(0,l.useState)(t),[r,c]=(0,l.useState)(!1);return(0,l.useEffect)(()=>o(t),[t]),(0,i.jsxs)("div",{className:"flex items-start gap-2",children:[r?(0,i.jsx)("textarea",{className:"w-full px-3 py-2 rounded-lg bg-[var(--color-khaki)] text-black placeholder-grey/60 text-opacity-60",value:d,onChange:e=>o(e.target.value),placeholder:"Add remarks",rows:6}):(0,i.jsx)("div",{className:"w-full min-h-[2.5rem] px-3 py-2 rounded-lg bg-[var(--color-khaki)] text-black whitespace-pre-wrap",children:d||"Add remarks"}),r?(0,i.jsx)("button",{type:"button",className:"px-3 py-2 rounded-md bg-[var(--color-rose)] text-white disabled:opacity-60",onClick:async()=>{await n(s,d),c(!1)},disabled:a,children:a?"Saving…":"Save"}):(0,i.jsx)("button",{type:"button","aria-label":"Edit remarks",className:"p-2 rounded-md bg-[var(--color-rose)] text-white hover:opacity-90",onClick:()=>c(!0),children:"✎"})]})}function h(){let[e,s]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let e=!1;return(async()=>{try{let i=await fetch("".concat("http://35.208.129.40:5000","/leads"));if(!i.ok)return;let l=await i.json();if(!e){var t;let e=Array.isArray(l)?l:null!=(t=null==l?void 0:l.leads)?t:[];s(e)}}catch(e){}})(),()=>{e=!0}},[]),(0,i.jsx)(c,{initialRows:e})}}},e=>{var s=s=>e(e.s=s);e.O(0,[268,441,684,358],()=>s(559)),_N_E=e.O()}]);